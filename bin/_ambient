#!/usr/bin/env bash

do_ambient()
{

   FOLDER="$1"


#   echo "Doing ambient from \"$FOLDER\""


   . $FOLDER/defer_ssh_agent


   AMBIENT_OUTPUT=`$FOLDER/__ambient --id-payload-listing`


   eval $AMBIENT_OUTPUT


   export __SYSTEM
   export __SYSTEM_FAMILY
   export __SYSTEM_BRANCH
   export __SYSTEM_RELEASE
   export __SYSTEM_SUDO_INSTALL
   export __SYSTEM_AMBIENT_RELEASE
   export __AMBIENT


   if [[ $__PATH_PREFIX ]]; then

      PATH=$__PATH_PREFIX:$PATH

      export PATH

   fi


}

if [[ "$0" != "$BASH_SOURCE" ]]; then

#   echo "_ambient is being sourced"

   SCRIPT_PATH="$BASH_SOURCE"
   
else

#   echo "_ambient is being run. This is likely to be wrong. _ambient should be sourced..."

   SCRIPT_PATH=$0

fi


#echo "Script's file path is $SCRIPT_PATH"


SCRIPT_FOLDER=$(dirname "$SCRIPT_PATH")


do_ambient "$SCRIPT_FOLDER"



